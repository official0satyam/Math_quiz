<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Class 12 ‚Äì Application of Derivatives Quiz</title>
<style>
  :root{
    --brand:#ff7e00;         /* orange */
    --brand-2:#ffb347;       /* light orange */
    --glass-bg: rgba(255,255,255,0.12);
    --glass-stroke: rgba(255,255,255,0.30);
    --text: #ffffff;
    --card-max-width: 760px;
    --ui-gap: clamp(8px, 1.5vw, 14px);
  }

  /* Reset & basics */
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    min-height:100vh;
    font-family: system-ui,-apple-system, "Segoe UI", Roboto, "Noto Sans", Arial, sans-serif;
    color:var(--text);
    background:
      radial-gradient(1200px 600px at 20% 0%, rgba(255,255,255,.18), transparent 60%),
      linear-gradient(120deg, #ff7e5f, #feb47b 45%, #ff7eb3 100%);
    overflow-x:hidden;
    display:flex; align-items:center; justify-content:center;
    padding:clamp(10px, 3vw, 18px);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* Background floating icons (parallax) */
  #bg{
    position:fixed; inset:0; overflow:hidden; z-index:0;
    will-change: transform;
    pointer-events:none;
  }
  .float-icon{
    position:absolute; font-weight:800; opacity:.14; user-select:none;
    animation: drift var(--dur,12s) linear infinite;
    filter: drop-shadow(0 6px 10px rgba(0,0,0,.25));
    white-space:nowrap;
    transform-origin:center;
  }
  @keyframes drift{
    from{ transform: translateY(110vh) rotate(0deg) }
    to{   transform: translateY(-120px) rotate(360deg) }
  }

  /* Foreground layout */
  #fg{ position:relative; z-index:1; width:100%; display:flex; justify-content:center; }
  .card{
    width:100%;
    max-width:var(--card-max-width);
    background: var(--glass-bg);
    border: 1px solid var(--glass-stroke);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,.25);
    padding: clamp(12px, 4vw, 28px);
    display:flex; flex-direction:column; gap:var(--ui-gap);
  }

  /* Header / title */
  .title{
    display:flex; align-items:center; gap:10px; margin:0;
    font-weight:900; letter-spacing:.2px; line-height:1;
    font-size: clamp(18px, 3.6vw, 26px);
  }

  /* Progress */
  .progress-wrap{margin: 6px 0 12px 0;}
  .progress{
    width:100%; height:10px; border-radius:999px; background:rgba(255,255,255,.22); overflow:hidden;
  }
  .bar{
    height:100%; width:0%;
    background: linear-gradient(90deg, #fff, var(--brand), var(--brand-2));
    transition: width .35s ease;
  }

  .qmeta{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap}
  .qno{opacity:.95; font-weight:800; margin-bottom:0; font-size: clamp(13px,2.6vw,16px)}
  .question{font-size: clamp(15px, 3.2vw, 20px); line-height:1.45; margin: 6px 0 2px 0; word-break:break-word}

  /* Image container */
  .image{
    display:flex; justify-content:center; align-items:center;
    background: rgba(255,255,255,.06);
    border:1px dashed rgba(255,255,255,.18);
    border-radius:12px; padding:10px; margin: 4px 0 10px 0;
    max-width:100%;
  }
  .image svg{ width:100%; height:auto; max-width:440px; display:block; }

  /* Options grid */
  .options{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: clamp(8px, 1.6vw, 12px);
  }
  .btn{
    appearance:none; border:none; border-radius:12px;
    padding: clamp(10px,2.6vw,14px) clamp(10px,2.8vw,14px);
    font-size: clamp(14px, 2.8vw, 16px);
    font-weight:800; color:#fff;
    background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(0,0,0,.10));
    box-shadow: inset 0 1px 0 rgba(255,255,255,.18), 0 6px 14px rgba(0,0,0,.18);
    cursor:pointer; text-align:left;
    transform: translateY(6px); opacity:0;
    animation: fadeInUp .36s ease forwards;
    transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
  }
  .btn:focus{ outline:3px solid rgba(255,126,0,.18); outline-offset:2px; }
  .btn:hover{ transform: translateY(0) scale(1.01); box-shadow: inset 0 1px 0 rgba(255,255,255,.22), 0 10px 18px rgba(0,0,0,.22) }
  .btn.correct{ background: linear-gradient(180deg, rgba(46, 204, 113,.92), rgba(39,174,96,.92)) }
  .btn.wrong{ background: linear-gradient(180deg, rgba(231, 76, 60,.92), rgba(192,57,43,.92)) }

  @keyframes fadeInUp{ to{opacity:1; transform: translateY(0)} }

  /* Footer area */
  .footer{
    margin-top: 6px;
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    opacity:.98; font-weight:700; font-size: clamp(12px,2.6vw,14px);
  }
  .status{display:flex; gap:10px; align-items:center}
  .next{
    margin-left:auto;
    background: linear-gradient(90deg, var(--brand), var(--brand-2));
    color:#fff; border:none; border-radius:999px;
    padding: clamp(8px,2vw,12px) clamp(14px,2.6vw,18px);
    font-weight:900; cursor:pointer;
    box-shadow: 0 8px 18px rgba(0,0,0,.22);
  }
  .next:disabled{opacity:.55; cursor:not-allowed; transform:none; box-shadow:none;}

  /* Modal (results & review) */
  .modal{
    position:fixed; inset:0; display:none; place-items:center; z-index:50;
    background: rgba(0,0,0,.36);
  }
  .modal-card{
    width:min(560px, 92vw);
    background: rgba(255,255,255,.98);
    color:#222; border-radius:14px; padding:18px; text-align:center;
    box-shadow: 0 16px 40px rgba(0,0,0,.35);
    animation: pop .22s ease;
  }
  @keyframes pop{ from{transform:scale(.96); opacity:0} to{transform:scale(1); opacity:1} }
  .modal .score{ font-size: clamp(18px, 4vw, 24px); font-weight:900; color:#e65100; margin-bottom:8px; }
  .pill{ display:inline-block; padding:8px 14px; border-radius:999px; background:#fff3e0; color:#bf360c; font-weight:900; }

  .actions{margin-top:12px; display:flex; gap:10px; justify-content:center; flex-wrap:wrap}
  .action{ border:none; padding:10px 16px; border-radius:12px; font-weight:900; cursor:pointer; }
  .primary{ background: linear-gradient(90deg, var(--brand), var(--brand-2)); color:#fff }
  .ghost{ background:#fff; border:2px solid #ffd9a6; color:#e65100 }

  /* Review list */
  .review-list{ margin-top:8px; text-align:left; background:#fff; border-radius:10px; padding:8px; max-height:60vh; overflow:auto; border:1px solid #ffd9a6; }
  .review-item{ padding:10px 6px; border-bottom:1px dashed #eee }
  .review-item:last-child{ border-bottom:none }
  .tag{ display:inline-block; padding:4px 8px; border-radius:999px; font-weight:800; font-size:12px; }
  .tag.correct{ background:#e8f5e9; color:#2e7d32; border:1px solid #a5d6a7 }
  .tag.wrong{ background:#ffebee; color:#c62828; border:1px solid #ef9a9a }

  /* Tiny screens / portrait phones */
  @media (max-width:520px){
    .options{ grid-template-columns: 1fr; }
    .card{ padding: clamp(10px,4vw,16px); border-radius:12px; }
    .image svg{ max-width:360px; }
  }

  @media (max-width:380px){
    .title{ font-size:16px; gap:8px; }
    .question{ font-size:14px; }
    .btn{ font-size:14px; padding:10px; }
    .footer{ flex-direction:column; align-items:flex-start; gap:8px; }
    .image{ padding:8px; }
  }

  /* Reduce visual weight on tiny devices */
  @media (prefers-reduced-motion:reduce){
    .float-icon, .btn{ animation:none !important; transition:none !important; }
  }
</style>
</head>
<body>

<!-- Floating maths icons (parallax) -->
<div id="bg" aria-hidden="true">
  <div class="float-icon" style="left:6%;   top:-10%; font-size:40px; --dur:13s;">‚àë</div>
  <div class="float-icon" style="left:18%;  top:-25%; font-size:54px; --dur:16s;">œÄ</div>
  <div class="float-icon" style="left:33%;  top:-15%; font-size:46px; --dur:12s;">‚àö</div>
  <div class="float-icon" style="left:56%;  top:-35%; font-size:52px; --dur:15s;">‚à´</div>
  <div class="float-icon" style="left:78%;  top:-20%; font-size:42px; --dur:14s;">¬±</div>
  <div class="float-icon" style="left:92%;  top:-30%; font-size:50px; --dur:17s;">√ó</div>
</div>

<!-- Foreground quiz -->
<div id="fg">
  <div class="card" id="card" role="main" aria-labelledby="quizTitle">
    <h1 id="quizTitle" class="title">üìò Class 12 ‚Äî Application of Derivatives</h1>

    <div class="progress-wrap" aria-hidden="true">
      <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
        <div class="bar" id="bar"></div>
      </div>
    </div>

    <div class="qmeta">
      <div class="qno" id="qno">Question 1 of N</div>
      <div class="status">Score: <b id="score">0</b></div>
    </div>

    <div class="question" id="question">Q. ...</div>
    <div class="image" id="image" style="display:none"></div>
    <div class="options" id="options" aria-live="polite" aria-atomic="true"></div>

    <div class="footer">
      <div style="opacity:.92; font-weight:800; font-size:13px;">Tip: Tap an option to answer</div>
      <button class="next" id="next" disabled aria-disabled="true">Next ‚ñ∂</button>
    </div>
  </div>
</div>

<!-- Result modal -->
<div class="modal" id="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal-card" role="document">
    <div class="score" id="finalScore">Your score</div>
    <div class="pill" id="summary">‚Äî</div>
    <div class="actions">
      <button class="action primary" onclick="restart()">üîÑ Play Again</button>
      <button class="action ghost" onclick="openReview()">üìñ Review Answers</button>
      <button class="action ghost" onclick="goHome()">üè† Home</button>
    </div>
  </div>
</div>

<!-- Review modal -->
<div class="modal" id="reviewModal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal-card" role="document">
    <h3 class="review-title" style="margin:0 0 10px 0; font-weight:900; color:#e65100;">üìñ Review Answers</h3>
    <div class="review-list" id="reviewList"></div>
    <div class="actions">
      <button class="action primary" onclick="restart()">üîÑ Play Again</button>
      <button class="action ghost" onclick="closeReview()">Close</button>
      <button class="action ghost" onclick="goHome()">üè† Home</button>
    </div>
  </div>
</div>

<!-- Confetti lib -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<script>
/* ===================== EDIT THIS: Home button link ===================== */
const HOME_URL = "https://sites.google.com/view/satyam-career/home"; // <‚Äî Replace with your site link
/* ======================================================================= */

/* ---------- Small inline SVG diagrams ---------- */
const svg = {
  parabola: `
    <svg viewBox="0 0 300 180" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="parabola diagram">
      <defs>
        <linearGradient id="g" x1="0" x2="1">
          <stop offset="0" stop-color="#fff" stop-opacity=".6"/>
          <stop offset="1" stop-color="#fff" stop-opacity=".9"/>
        </linearGradient>
      </defs>
      <rect width="100%" height="100%" rx="10" fill="url(#g)" opacity=".06"/>
      <g transform="translate(20,10)">
        <line x1="0" y1="140" x2="260" y2="140" stroke="#fff" stroke-opacity=".6"/>
        <line x1="130" y1="0" x2="130" y2="160" stroke="#fff" stroke-opacity=".6"/>
        <path d="M 10 140 Q 130 10 250 140" fill="none" stroke="#ffecb3" stroke-width="3"/>
        <circle cx="190" cy="62" r="4" fill="#fff"/>
        <text x="196" y="58" fill="#fff" font-size="12">x=3</text>
      </g>
    </svg>`,
  circle: `
    <svg viewBox="0 0 300 180" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="circle diagram">
      <rect width="100%" height="100%" rx="10" fill="#fff" opacity=".04"/>
      <g transform="translate(150,90)">
        <circle r="60" fill="none" stroke="#ffecb3" stroke-width="3"/>
        <line x1="0" y1="0" x2="60" y2="0" stroke="#fff"/>
        <text x="30" y="-6" fill="#fff" font-size="12">r</text>
      </g>
    </svg>`,
  square: `
    <svg viewBox="0 0 300 180" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="square diagram">
      <rect width="100%" height="100%" rx="10" fill="#fff" opacity=".04"/>
      <rect x="90" y="30" width="120" height="120" fill="none" stroke="#ffecb3" stroke-width="3"/>
      <text x="150" y="26" text-anchor="middle" fill="#fff" font-size="12">side = s</text>
    </svg>`,
  rect: `
    <svg viewBox="0 0 300 180" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="rectangle diagram">
      <rect width="100%" height="100%" rx="10" fill="#fff" opacity=".04"/>
      <rect x="60" y="50" width="180" height="80" fill="none" stroke="#ffecb3" stroke-width="3"/>
      <text x="150" y="46" text-anchor="middle" fill="#fff" font-size="12">x</text>
      <text x="48" y="95" text-anchor="end" fill="#fff" font-size="12">16/x</text>
    </svg>`,
  line: `
    <svg viewBox="0 0 300 180" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="line graph">
      <rect width="100%" height="100%" rx="10" fill="#fff" opacity=".04"/>
      <g transform="translate(20,10)">
        <line x1="0" y1="140" x2="260" y2="140" stroke="#fff" stroke-opacity=".6"/>
        <line x1="130" y1="0" x2="130" y2="160" stroke="#fff" stroke-opacity=".6"/>
        <path d="M 0 160 L 260 40" stroke="#ffecb3" stroke-width="3" fill="none"/>
        <circle cx="170" cy="80" r="4" fill="#fff"/>
        <text x="176" y="76" fill="#fff" font-size="12">x=1</text>
      </g>
    </svg>`
  // other svg keys intentionally omitted: missing keys will simply hide the image
};

/* ============================================================
   QUIZ QUESTIONS ‚Äî same as you had (no logic changes)
   Keep Qs here ‚Äî answer must exactly match an option string
   ============================================================ */
const questions = [
  { q: "Find the slope of the tangent to y = x¬≤ at x = 3.", options: ["3","6","9","12"], answer: "6", img: "svg.parabola" },
  { q: "If radius of a circle increases at 2 cm/s, find the rate of change of area when r = 7 cm.", options: ["28œÄ cm¬≤/s","14œÄ cm¬≤/s","21œÄ cm¬≤/s","49œÄ cm¬≤/s"], answer: "28œÄ cm¬≤/s", img: "svg.circle" },
  { q: "Find dy/dx at x = 2 for y = 3x¬≤.", options: ["6","9","12","8"], answer: "12" },
  { q: "For f(x) = x¬≤ ‚àí 4x + 5, the function is decreasing in which interval?", options: ["x > 2","x < 2","x = 2","None"], answer: "x < 2" },
  { q: "The maximum value of y = ‚àíx¬≤ + 4x occurs at:", options: ["x = 0","x = 1","x = 2","x = 4"], answer: "x = 2" },
  { q: "Find the equation of the tangent to y = 2x + 3 at x = 1.", options: ["y = 2x + 1","y = 2x + 5","y = x + 3","y = 2x ‚àí 1"], answer: "y = 2x + 5", img: "svg.line" },
  { q: "If each side of a square increases at 5 cm/s, find the rate of change of area when side = 4 cm.", options: ["20 cm¬≤/s","25 cm¬≤/s","40 cm¬≤/s","50 cm¬≤/s"], answer: "40 cm¬≤/s", img: "svg.square" },
  { q: "What value of x minimizes P = x + 16/x for x > 0?", options: ["2","4","6","8"], answer: "4", img: "svg.rect" },
  { q: "Use linear approximation of f(x)=‚àöx near x=36 to estimate ‚àö36.5.", options: ["6.01","6.02","6.03","6.04"], answer: "6.02" },
  { q: "If dy/dx = 0 at x = 3, then at x = 3 the function has:", options: ["Maximum","Minimum","Turning point","Cannot say without more info"], answer: "Cannot say without more info" },

  { q: "Find the slope of tangent to y = x¬≥ at x = 1.", options: ["1","2","3","4"], answer: "3", img: "svg.parabola" },
  { q: "If y = sinx + cosx, find dy/dx.", options: ["cosx ‚àí sinx","cosx + sinx","sinx ‚àí cosx","sinx + cosx"], answer: "cosx ‚àí sinx" },
  { q: "At which x does f(x) = x‚Å¥ ‚àí 8x¬≤ + 17 have a minimum value?", options: ["x = ‚àí2","x = 2","x = 0","x = 4"], answer: "x = 0" },
  { q: "If profit P(x) = x¬≥ ‚àí 6x¬≤ + 9x + 15, find critical points.", options: ["x = 1,3","x = 2,3","x = 0,3","x = 1,2"], answer: "x = 1,3" },
  { q: "Find the rate of change of the volume of a cube when edge = 5cm and increasing at 2cm/s.", options: ["150cm¬≥/s","100cm¬≥/s","125cm¬≥/s","75cm¬≥/s"], answer: "150cm¬≥/s" },
  { q: "For y = 3x¬≤ ‚àí 2x + 5, calculate d¬≤y/dx¬≤.", options: ["6","3","0","2"], answer: "6" },
  { q: "If the function y = x¬≥‚àí9x¬≤+24x+5 is increasing for:", options: ["x > 2","x < 2","2 < x < 4","x < 4"], answer: "2 < x < 4" },
  { q: "The tangent to the curve y = x¬≤ at (2,4) makes an angle of:", options: ["45¬∞","60¬∞","75¬∞","90¬∞"], answer: "63.43¬∞" },
  { q: "Find the maximum area of rectangle inscribed in a circle of radius r.", options: ["r¬≤","2r¬≤","r¬≤/2","4r¬≤"], answer: "2r¬≤" },
  { q: "If y = ln(x¬≤+1), find dy/dx at x = 1.", options: ["1","2","0.5","0"], answer: "1" },

  { q: "What is the minimum value for f(x) = x¬≤ ‚àí 6x + 11?", options: ["11","10","2","8"], answer: "2" },
  { q: "If the side of an equilateral triangle increases at 2cm/s, area changes at:", options: ["2cm¬≤/s","5cm¬≤/s","5‚àö3cm¬≤/s","4cm¬≤/s"], answer: "5‚àö3cm¬≤/s" },
  { q: "f(x) = sinx, find d¬≤y/dx¬≤ at x = œÄ/2.", options: ["‚àí1","0","1","None"], answer: "‚àí1" },
  { q: "Radius of sphere increases at 0.1cm/s, find rate of volume change at r = 1cm.", options: ["0.4œÄcm¬≥/s","0.1œÄcm¬≥/s","1.2œÄcm¬≥/s","1cm¬≥/s"], answer: "0.4œÄcm¬≥/s" },
  { q: "For y = x¬≥ ‚àí 4x, point of inflection is:", options: ["x = 0","x = ¬±2","x = 1","x = 4"], answer: "x = 0" },
  { q: "Find equation of normal to y = x¬≤ ‚àí 2x + 3 at x = 1.", options: ["y = ‚àíx + 4","y = ‚àíx + 3","y = x + 1","y = x ‚àí 2"], answer: "y = ‚àíx + 4" },
  { q: "Maximum value of f(x) = 3sinx + 4cosx is:", options: ["3","4","5","7"], answer: "5" },
  { q: "For y = 2eÀ£, slope of tangent at x = 0:", options: ["1","2","0","e"], answer: "2" },
  { q: "Minimum value of y = x‚Å¥ for x in [‚àí2,3]:", options: ["0","16","81","256"], answer: "0" },
  { q: "If cost C(x) = x¬≤ ‚àí 8x + 30, marginal cost at x = 5:", options: ["‚àí2","2","0","3"], answer: "2" }
];

/* ---------- WebAudio tiny SFX (works after first tap) ---------- */
let audioReady = false, ctx, masterGain;
function initAudio(){
  if(audioReady) return;
  try{
    ctx = new (window.AudioContext || window.webkitAudioContext)();
    masterGain = ctx.createGain(); masterGain.gain.value = 0.32; masterGain.connect(ctx.destination);
    audioReady = true;
  }catch(e){ audioReady = false; }
}
function tone(freq=660, dur=0.12, type='sine'){
  if(!audioReady) return;
  const o = ctx.createOscillator();
  const g = ctx.createGain();
  o.type = type; o.frequency.value = freq;
  g.gain.setValueAtTime(0.0001, ctx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.6, ctx.currentTime+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+dur);
  o.connect(g); g.connect(masterGain);
  o.start(); o.stop(ctx.currentTime+dur);
}
const sfx = {
  click(){ tone(520, .07, 'triangle'); },
  correct(){ tone(740, .10, 'sine'); setTimeout(()=>tone(980,.12,'sine'), 110); },
  wrong(){ tone(180, .18, 'square'); },
  finish(){ tone(660,.12,'sine'); setTimeout(()=>tone(880,.12,'sine'),130); setTimeout(()=>tone(1040,.16,'triangle'),260); }
};

/* ---------- Quiz Logic + Review ---------- */
let i = 0, score = 0, locked = false;
let userAnswers = []; // stores {q, selected, correct}

const elQno = document.getElementById('qno');
const elQ = document.getElementById('question');
const elImg = document.getElementById('image');
const elOpts = document.getElementById('options');
const elScore = document.getElementById('score');
const elBar = document.getElementById('bar');
const elNext = document.getElementById('next');
const elModal = document.getElementById('modal');
const elFinal = document.getElementById('finalScore');
const elSummary = document.getElementById('summary');
const elReviewModal = document.getElementById('reviewModal');
const elReviewList = document.getElementById('reviewList');

function render() {
  const q = questions[i];
  elQno.textContent = `Question ${i + 1} of ${questions.length}`;
  elQ.textContent = "Q. " + q.q;

  if (q.img) {
    // Extract key after 'svg.'
    const parts = q.img.split(".");
    const imgKey = parts.length > 1 ? parts[1] : null;
    if (imgKey && svg[imgKey]) {
      elImg.style.display = "flex";
      elImg.innerHTML = svg[imgKey];
    } else {
      elImg.style.display = "none";
      elImg.innerHTML = "";
    }
  } else {
    elImg.style.display = "none";
    elImg.innerHTML = "";
  }

  // Build options (shuffle for small variety)
  elOpts.innerHTML = "";
  const opts = [...q.options];
  // small deterministic shuffle based on index to keep reproducible order across loads
  const shift = i % opts.length;
  const arranged = opts.slice(shift).concat(opts.slice(0, shift));
  arranged.forEach((opt, idx) => {
    const b = document.createElement("button");
    b.className = "btn";
    b.style.animationDelay = `${idx * 0.05 + 0.03}s`;
    b.textContent = opt;
    b.type = "button";
    b.onclick = () => select(opt, b);
    b.setAttribute('aria-label', `Answer option: ${opt}`);
    elOpts.appendChild(b);
  });

  // update progress bar (show fraction of completed questions)
  const pct = ((i) / questions.length) * 100;
  elBar.style.width = pct.toFixed(2) + "%";
  elNext.disabled = true;
  elNext.setAttribute('aria-disabled', 'true');
  locked = false;
  // ensure score shown
  elScore.textContent = score;
}

function select(opt, btn){
  initAudio();
  if(locked) return;
  sfx.click();
  locked = true;

  const correct = opt === questions[i].answer;
  userAnswers.push({ q: questions[i].q, selected: opt, correct: questions[i].answer });

  if(correct){ score++; btn.classList.add('correct'); sfx.correct(); }
  else{ btn.classList.add('wrong'); sfx.wrong(); }

  // reveal correct answer and disable all
  [...elOpts.children].forEach(b=>{
    if(b.textContent === questions[i].answer) b.classList.add('correct');
    b.disabled = true;
    b.setAttribute('aria-disabled','true');
  });

  elScore.textContent = score;
  elNext.disabled = false;
  elNext.setAttribute('aria-disabled','false');
  // let Next button be focusable on mobile
  elNext.focus();
}

elNext.addEventListener('click', ()=>{
  i++;
  if(i < questions.length){ render(); window.scrollTo({top:0, behavior:'smooth'}); }
  else{ finish(); }
});

function finish(){
  sfx.finish();
  elBar.style.width = '100%';
  try{
    confetti({particleCount: 140, spread: 70, origin:{y:.7}});
    setTimeout(()=>confetti({particleCount: 100, spread: 100, origin:{y:.2}}), 180);
  }catch(e){}
  elFinal.textContent = `üéâ Quiz Completed!`;
  elSummary.textContent = `You scored ${score} out of ${questions.length}`;
  elModal.style.display = 'grid';
  elModal.setAttribute('aria-hidden','false');
  // focus first action for keyboard users
  setTimeout(()=>{ const btn = elModal.querySelector('button'); if(btn) btn.focus(); }, 80);
}

function restart(){
  elModal.style.display = 'none';
  elModal.setAttribute('aria-hidden','true');
  elReviewModal.style.display = 'none';
  elReviewModal.setAttribute('aria-hidden','true');
  i = 0; score = 0; userAnswers = [];
  elScore.textContent = score;
  render();
}

function openReview(){
  // build review list
  elReviewList.innerHTML = '';
  userAnswers.forEach((a, idx)=>{
    const div = document.createElement('div');
    const isCorrect = a.selected === a.correct;
    div.className = 'review-item';
    div.innerHTML = `
      <div style="display:flex; align-items:center; justify-content:space-between; gap:10px;">
        <div style="font-weight:800;">Q${idx+1}</div>
        <span class="tag ${isCorrect?'correct':'wrong'}">${isCorrect?'Correct':'Wrong'}</span>
      </div>
      <div style="margin:6px 0 4px 0; color:#333; font-weight:700;">${a.q}</div>
      <div style="font-size:14px; color:#444;">Your answer: <b style="color:${isCorrect?'#2e7d32':'#c62828'}">${a.selected}</b></div>
      <div style="font-size:14px; color:#444;">Correct answer: <b style="color:#2e7d32">${a.correct}</b></div>
    `;
    elReviewList.appendChild(div);
  });
  elModal.style.display = 'none';
  elModal.setAttribute('aria-hidden','true');
  elReviewModal.style.display = 'grid';
  elReviewModal.setAttribute('aria-hidden','false');
  setTimeout(()=>{ const btn = elReviewModal.querySelector('button'); if(btn) btn.focus(); }, 80);
}
function closeReview(){
  elReviewModal.style.display = 'none';
  elReviewModal.setAttribute('aria-hidden','true');
  elModal.style.display = 'grid';
  elModal.setAttribute('aria-hidden','false');
}

function goHome(){
  window.open(HOME_URL, "_blank");
}

// Start quiz
render();
// First tap initializes audio (mobile)
window.addEventListener('pointerdown', initAudio, {once:true});

/* ---------- Subtle Parallax for icons layer (#bg) ---------- */
(function(){
  const bg = document.getElementById('bg');
  function applyParallax(xRatio, yRatio){
    const x = (xRatio - 0.5) * 18;
    const y = (yRatio - 0.5) * 12;
    bg.style.transform = `translate3d(${x}px, ${y}px, 0)`;
  }
  window.addEventListener('pointermove', (e)=>{
    const xRatio = e.clientX / window.innerWidth;
    const yRatio = e.clientY / window.innerHeight;
    applyParallax(xRatio, yRatio);
  }, {passive:true});
  window.addEventListener('deviceorientation', (e)=>{
    if(e && typeof e.beta === 'number' && typeof e.gamma === 'number'){
      const xRatio = (e.gamma + 45) / 90;
      const yRatio = (e.beta  + 45) / 90;
      applyParallax(Math.min(Math.max(xRatio,0),1), Math.min(Math.max(yRatio,0),1));
    }
  });
})();
</script>
</body>
</html>
